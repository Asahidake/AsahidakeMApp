{"version":3,"file":"urlhistory.js","sources":["../../js/nav/loading.js","../../js/nav/map-control.js","../../js/urlhistory.js"],"sourcesContent":["import $ from 'jquery';\n\n/**\n * Load content from url and insert it into target element.\n * @param {string} target - Element selector\n * @param {string} url - Url to load\n */\nexport function loadURL(selector, url) {\n  return new Promise((resolve, reject) => {\n    $(selector).load(url, (_, status, xhr) => {\n      if (status === 'error') {\n        reject(new LoadError(xhr.status, xhr.statusText));\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nclass LoadError extends Error {\n  constructor(statusCode, statusText) {\n    super(statusText);\n    this.code = statusCode;\n  }\n}\n","/**\n * この関数はAsahidakeMapのwrapperで、\n * マップのスクリプトロード済まない場合、cacheするためのもの\n */\n\nlet hasLoaded = false;\nlet deferedFit = null;\n/**\n * Viewの範囲変化\n *\n * @param {string|Array<number>} extent - 登山道のstring又はnumberのarray\n */\nexport function fitView(view) {\n  if (hasLoaded) {\n    return AsahidakeMap.fitView(view);\n  }\n\n  deferedFit = view;\n}\n\nlet deferedHighlight = null;\n/**\n * 登山道ハイライト\n * 現在ハイライトできる登山道は：（./extents.jsによる}\n * sugatami, summit, nakadake, loop, tennyoga, nakadake\n *\n * @param {string} trail - 登山道の名前 (romajiで)\n */\nexport function highlightTrail(trail) {\n  if (hasLoaded) {\n    return AsahidakeMap.highlightTrail(trail);\n  }\n\n  deferedHighlight = trail;\n}\n\nexport async function getMap() {\n  const map = await loadMap();\n  return map;\n}\n\nfunction loadMap() {\n  return new Promise((resolve, reject) => {\n    if (window.AsahidakeMap !== undefined) {\n      return resolve(window.AsahidakeMap);\n    }\n\n    const scriptElement = document.getElementById('map-script');\n    scriptElement.addEventListener('load', () => {\n      if (window.AsahidakeMap !== undefined) {\n        hasLoaded = true;\n        resolve(window.AsahidakeMap);\n      } else {\n        reject(new Error('Error loading map script'));\n      }\n    });\n  });\n}\n\nloadMap();\n","import { loadURL } from './nav/loading.js';\nimport { fitView, highlightTrail } from './nav/map-control.js';\n/**\n * ナビの処理\n * いつも同じようにナビするため、必ずこの関数を使って\n * @param {string} target - 次のページ\n */\nexport async function doNav(target) {\n  // マップ更新はload後ため、loadURLはawait\n  switch (target) {\n    case 'aboutDaisetsuzan':\n      await loadURL('#column', 'aboutDaisetsuzan.html');\n      fitView('loop');\n      highlightTrail(null);\n      break;\n    case 'aboutTrailToPeak':\n      await loadURL('#column', 'aboutTrailToPeak.html');\n      fitView('summit');\n      highlightTrail('summit');\n      break;\n    case 'about6hLoop':\n      await loadURL('#column', 'about6hLoop.html');\n      fitView('loop');\n      highlightTrail('loop');\n      break;\n    case 'info':\n      await loadURL('#column', 'info.html');\n      highlightTrail(null);\n      break;\n    case 'aboutDaisetsuzanGrade':\n      await loadURL('#column', 'aboutDaisetsuzanGrade.html');\n      highlightTrail(null);\n      break;\n    case 'blog':\n      await loadURL('#column', 'blog.html');\n      highlightTrail(null);\n      break;\n    case 'aboutSugatami':\n    default:\n      // 404 = aboutSugatami\n      await loadURL('#column', 'aboutSugatami.html');\n      fitView('sugatami');\n      highlightTrail('sugatami');\n      break;\n  }\n}\n\nexport function pushStateAndNav(pageName) {\n  console.dir('pushStateAndNav');\n  window.history.pushState({ page: pageName }, null, '#/' + pageName);\n  doNav(pageName);\n}\n\n//クリックイベント関数の簡略化\n//javascript使っていたり　JQuery使っていたり分かりづらい\n//統一すべき\nfunction onClick(id, callback) {\n  document.getElementById(id).addEventListener('click', callback);\n}\n//各ボタンの処理\nonClick('aboutDaisetsuzan', function () {\n  pushStateAndNav('aboutDaisetsuzan');\n});\n\nonClick('aboutSugatami', function () {\n  pushStateAndNav('aboutSugatami');\n});\n\nonClick('aboutTrailToPeak', function () {\n  pushStateAndNav('aboutTrailToPeak');\n});\n\nonClick('about6hLoop', function () {\n  pushStateAndNav('about6hLoop');\n});\n\nonClick('info', function () {\n  pushStateAndNav('info');\n  // $(\"html,body\").animate({scrollTop:position},600);\n});\n\nonClick('aboutDaisetsuzanGrade', function () {\n  pushStateAndNav('aboutDaisetsuzanGrade');\n});\n\nonClick('blog', function () {\n  pushStateAndNav('blog');\n});\n\nconst navElements = document.querySelectorAll('.navbar-burger,.navbar-menu');\n\nfunction toggleNavBarClass() {\n  for (let element of navElements) {\n    element.classList.toggle('is-active');\n  }\n}\n\nfor (let element of navElements) {\n  // navElementsは本当のArrayじゃないから、for (... of ...)のみ使える\n  element.addEventListener('click', toggleNavBarClass);\n}\n\nwindow.onpopstate = function () {\n  const page = history.state !== null ? history.state.page : null;\n  console.dir('onpopstate  state:' + page);\n  doNav(page);\n};\n\ndoNav(document.location.hash.substring(2));\n"],"names":["loadURL","selector","url","Promise","resolve","reject","$","load","_","status","xhr","LoadError","statusText","Error","[object Object]","statusCode","super","this","code","hasLoaded","fitView","view","AsahidakeMap","highlightTrail","trail","async","doNav","target","pushStateAndNav","pageName","console","dir","window","history","pushState","page","onClick","id","callback","document","getElementById","addEventListener","undefined","navElements","querySelectorAll","toggleNavBarClass","element","classList","toggle","onpopstate","state","location","hash","substring"],"mappings":"6HAOO,SAASA,EAAQC,EAAUC,GAChC,OAAO,IAAIC,QAAQ,CAACC,EAASC,KAC3BC,UAAEL,GAAUM,KAAKL,EAAK,CAACM,EAAGC,EAAQC,KACjB,UAAXD,EACFJ,EAAO,IAAIM,EAAUD,EAAID,OAAQC,EAAIE,aAErCR,QAMR,MAAMO,UAAkBE,MACtBC,YAAYC,EAAYH,GACtBI,MAAMJ,GACNK,KAAKC,KAAOH,GCjBhB,IAAII,GAAY,EAOT,SAASC,EAAQC,GACtB,GAAIF,EACF,OAAOG,aAAaF,QAAQC,GAczB,SAASE,EAAeC,GAC7B,GAAIL,EACF,OAAOG,aAAaC,eAAeC,GCvBhCC,eAAeC,EAAMC,GAE1B,OAAQA,GACN,IAAK,yBACG3B,EAAQ,UAAW,yBACzBoB,EAAQ,QACRG,EAAe,MACf,MACF,IAAK,yBACGvB,EAAQ,UAAW,yBACzBoB,EAAQ,UACRG,EAAe,UACf,MACF,IAAK,oBACGvB,EAAQ,UAAW,oBACzBoB,EAAQ,QACRG,EAAe,QACf,MACF,IAAK,aACGvB,EAAQ,UAAW,aACzBuB,EAAe,MACf,MACF,IAAK,8BACGvB,EAAQ,UAAW,8BACzBuB,EAAe,MACf,MACF,IAAK,aACGvB,EAAQ,UAAW,aACzBuB,EAAe,MACf,MACF,IAAK,gBACL,cAEQvB,EAAQ,UAAW,sBACzBoB,EAAQ,YACRG,EAAe,aAKd,SAASK,EAAgBC,GAC9BC,QAAQC,IAAI,mBACZC,OAAOC,QAAQC,UAAU,CAAEC,KAAMN,GAAY,KAAM,KAAOA,GAC1DH,EAAMG,GAMR,SAASO,EAAQC,EAAIC,GACnBC,SAASC,eAAeH,GAAII,iBAAiB,QAASH,GDf/C,IAAInC,QAAQ,CAACC,EAASC,KAC3B,QAA4BqC,IAAxBV,OAAOV,aACT,OAAOlB,EAAQ4B,OAAOV,cAGFiB,SAASC,eAAe,cAChCC,iBAAiB,OAAQ,UACTC,IAAxBV,OAAOV,cACTH,GAAY,EACZf,EAAQ4B,OAAOV,eAEfjB,EAAO,IAAIQ,MAAM,iCCOzBuB,EAAQ,oBAAoB,WAC1BR,EAAgB,uBAGlBQ,EAAQ,iBAAiB,WACvBR,EAAgB,oBAGlBQ,EAAQ,oBAAoB,WAC1BR,EAAgB,uBAGlBQ,EAAQ,eAAe,WACrBR,EAAgB,kBAGlBQ,EAAQ,QAAQ,WACdR,EAAgB,WAIlBQ,EAAQ,yBAAyB,WAC/BR,EAAgB,4BAGlBQ,EAAQ,QAAQ,WACdR,EAAgB,WAGlB,MAAMe,EAAcJ,SAASK,iBAAiB,+BAE9C,SAASC,IACP,IAAK,IAAIC,KAAWH,EAClBG,EAAQC,UAAUC,OAAO,aAI7B,IAAK,IAAIF,KAAWH,EAElBG,EAAQL,iBAAiB,QAASI,UAGpCb,OAAOiB,WAAa,WAClB,MAAMd,EAAyB,OAAlBF,QAAQiB,MAAiBjB,QAAQiB,MAAMf,KAAO,KAC3DL,QAAQC,IAAI,qBAAuBI,GACnCT,EAAMS,IAGRT,EAAMa,SAASY,SAASC,KAAKC,UAAU"}