var AsahidakeMap=function(e){"use strict";var t=window.matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches,r=new ol.layer.Tile({source:new ol.source.XYZ(t?{url:"/map/tiles/2x/{z}/{x}/{y}.png",tilePixelRatio:2}:{url:"/map/tiles/{z}/{x}/{y}.png",tilePixelRatio:1}),extent:[15890800,5401150,15918700,5426850],interactive:!0});function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return l=e.done,e},e:function(e){c=!0,a=e},f:function(){try{l||null==r.return||r.return()}finally{if(c)throw a}}}}var c=new Map;function u(e){var t="/map/data/"+e;if(c.has(t))return c.get(t);try{var r=fetch(t).then((function(e){return e.json()}));return c.set(t,r),r}catch(e){console.error("The following error occured when loading geodata"),console.error(e)}}var s=new ol.format.GeoJSON;function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Promise.resolve(t).then((function(t){if(null===t||!Array.isArray(t.features)||t.features.length<1)e.set("title",null);else{var n=new ol.source.Vector(a(a({},r),{},{features:s.readFeatures(t,{featureProjection:"EPSG:3857"})}));e.setSource(n)}}))}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;switch(e){case 1:return"rgba(62,119,200,".concat(t,")");case 2:return"rgba(33,153,31,".concat(t,")");case 3:return"rgba(255,202,0,".concat(t,")");case 4:return"rgba(242,133,0,".concat(t,")");case 5:return"rgba(235,25,60,".concat(t,")");default:return"rgba(66,66,66,".concat(t,")")}}function h(e){var t=e.get("grade"),r=e.get("trails"),n=d.currentTrail,o=null===n||r.includes(n)?1:.5;return new ol.style.Style({stroke:new ol.style.Stroke({color:g(t,o),width:3})})}function y(e){var t=g(e);return'\n  <svg width="1em" height="1em" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M0 50 H 100" stroke="'.concat(t,'" stroke-width="20" /></svg>\n  ')}var p=[1,2,3,4,5].map((function(e){var t=new ol.layer.Vector({source:null,style:h,interactive:!0,title:"".concat(y(e)," グレード ").concat(e)});return f(t,u("base.json").then((function(t){return function(e,t){if(void 0===e||!Array.isArray(e.features))return console.warn("Unable to filter trail features"),e;var r=e.features.filter((function(e){return e.properties.grade===t}));return a(a({},e),{},{features:r})}(t.trails,e)})),{attributions:'<a href="http://www.daisetsuzan.or.jp/">大雪山国立公園連絡協議会</a>'}),t})),w=["summit","nakadake","tennyogahara","loop"];function v(e){this.updateLayers=e,this.currentTrail=null}v.prototype.update=function(e){null===e||w.includes(e)||(console.warn("Can't highlight ".concat(e,". No matching trail found")),e=null),this.currentTrail=e,this.updateLayers.forEach((function(e){return e.changed()}))},v.prototype.summit=function(){this.update("summit")},v.prototype.loop=function(){this.update("loop")},v.prototype.nakadake=function(){this.update("nakadake")},v.prototype.tennyogahara=function(){this.update("tennyogahara")},v.prototype.clear=function(){this.update(null)};var d=new v(p),b="rgba(64, 64, 64, 1)",m=new ol.style.RegularShape({radius:5,points:3,fill:new ol.style.Fill({color:b})});function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"jp";return function(t){var r=t.get(e);if(null===r)return ol.style.Style({image:m});var n="jp"===e?'0.8em "ヒラギノ角ゴ Pro W6", "Hiragino Kaku Gothic Pro",Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif':"0.7em Arial Black, Arial, sans-serif",o=new ol.style.Text({font:n,text:r,textBaseline:"bottom",textAlign:"center",offsetX:0,offsetY:-7,placement:"point",maxAngle:0,fill:new ol.style.Fill({color:b}),stroke:new ol.style.Stroke({color:"rgba(255, 255, 255, 1)",width:3})});return new ol.style.Style({image:m,text:o})}}var k={declutter:!0,interactive:!0,type:"base"},x=new ol.layer.Vector(a(a({},k),{},{style:j("jp"),title:"日本語"})),O=new ol.layer.Vector(a(a({},k),{},{style:j("en"),title:"English",visible:!1})),S=u("base.json").then((function(e){return e.labels}));f(x,S),f(O,S);function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rgba(66, 66, 66, 1)";return function(){return new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new ol.style.Stroke({color:e,width:3})})})}}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgba(66, 66, 66, 1)";return'<svg width="1em" height="1em" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><circle stroke="'.concat(t,'" fill="#fff" stroke-width="20" cx="50" cy="50" r="40"></circle></svg> ').concat(e)}function L(e){var t=new ol.layer.Vector({declutter:!0,interactive:!0,style:P(e.color),title:A(e.title,e.color)});return t.on("change",V),f(t,u(e.source)),t}var T=L({source:"nakadake.json",title:"中岳温泉コース",color:"rgba(126,179,44,1)"}),M=L({source:"summit.json",title:"旭岳山頂コース",color:"rgba(255,202,0,1)"}),E=L({source:"loop.json",title:"一日周回コース",color:"rgba(242,133,0,1)"}),F=[L({source:"tennyoga.json",title:"天女ヶ原コース",color:"rgba(33,153,31,1)"}),E,T,M],G=new Map;function V(e){var t=e.target.getSource();if(null!==t){var r,n=l(t.getFeatures());try{for(n.s();!(r=n.n()).done;){var o=r.value,a=o.get("src"),i=o.getGeometry(),c=i instanceof ol.geom.Point?i.getCoordinates():void 0;G.set("/images/MapPics/"+a,c)}}catch(e){n.e(e)}finally{n.f()}}}var B=[];var C=null;function D(){null!==C&&clearTimeout(C),C=setTimeout((function(){C=null,B.length>0&&B.forEach((function(e){return e()}))}),200)}return F.forEach((function(e){e.on("change:source",D)})),e.baseTiles=r,e.enLabelsLayer=O,e.highlight=d,e.jpLabelsLayer=x,e.onPhotosLoad=function(e){B.push(e)},e.photoLayers=F,e.photoLocations=G,e.trailLayers=p,e}({});
