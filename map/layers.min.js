var AsahidakeMap=function(e){"use strict";const t=new ol.layer.Tile({source:new ol.source.XYZ({url:"/layers/baseMapTiles/{z}/{x}/{y}.png",tilePixelRatio:1}),extent:[15890800,5401150,15918700,5426850],interactive:!0}),r=new Map;function o(e){const t="/map/data/"+e;if(r.has(t))return r.get(t);try{const e=fetch(t).then(e=>e.json());return r.set(t,e),e}catch(e){console.error("The following error occured when loading geodata"),console.error(e)}}const n=new ol.format.GeoJSON;function l(e,t,r={}){return Promise.resolve(t).then(t=>{if(null===t||!Array.isArray(t.features)||t.features.length<1)return void e.set("title",null);const o=new ol.source.Vector({...r,features:n.readFeatures(t,{featureProjection:"EPSG:3857"})});e.setSource(o)})}function s(e,t=1){switch(e){case 1:return`rgba(62,119,200,${t})`;case 2:return`rgba(33,153,31,${t})`;case 3:return`rgba(255,202,0,${t})`;case 4:return`rgba(242,133,0,${t})`;case 5:return`rgba(235,25,60,${t})`;default:return`rgba(66,66,66,${t})`}}const a=["summit","nakadake","tennyoga","tennyogahara","loop"];let i=null;function c(e){const t=e.get("grade"),r=e.get("trails"),o=s(t,null===i||r.includes(i)?1:.5);return new ol.style.Style({stroke:new ol.style.Stroke({color:o,width:3})})}function u(e){return`\n  <svg width="1em" height="1em" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M0 50 H 100" stroke="${s(e)}" stroke-width="20" /></svg>\n  `}const g=[1,2,3,4,5].map((function(e){const t=new ol.layer.Vector({source:null,style:c,interactive:!0,title:`${u(e)} グレード ${e}`});return l(t,o("base.json").then(t=>function(e,t){if(void 0===e||!Array.isArray(e.features))return console.warn("Unable to filter trail features"),e;const r=e.features.filter(e=>e.properties.grade===t);return{...e,features:r}}(t.trails,e)),{attributions:'<a href="http://www.daisetsuzan.or.jp/">大雪山国立公園連絡協議会</a>'}),t})),f=new ol.style.RegularShape({radius:5,points:3,fill:new ol.style.Fill({color:"rgba(64, 64, 64, 1)"})});function w(e="jp"){return function(t){const r=t.get(e);if(null===r)return ol.style.Style({image:f});const o="jp"===e?'0.8em "ヒラギノ角ゴ Pro W6", "Hiragino Kaku Gothic Pro",Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif':"0.7em Arial Black, Arial, sans-serif",n=new ol.style.Text({font:o,text:r,textBaseline:"bottom",textAlign:"center",offsetX:0,offsetY:-7,placement:"point",maxAngle:0,fill:new ol.style.Fill({color:"rgba(64, 64, 64, 1)"}),stroke:new ol.style.Stroke({color:"rgba(255, 255, 255, 1)",width:3})});return new ol.style.Style({image:f,text:n})}}const h={declutter:!0,interactive:!0,type:"base"},y=new ol.layer.Vector({...h,style:w("jp"),title:"日本語"}),d=new ol.layer.Vector({...h,style:w("en"),title:"English",visible:!1}),p=o("base.json").then(e=>e.labels);l(y,p),l(d,p);function m(e="rgba(66, 66, 66, 1)"){return()=>new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(255, 255, 255, 1)"}),stroke:new ol.style.Stroke({color:e,width:3})})})}function b(e,t="rgba(66, 66, 66, 1)"){return`<svg width="1em" height="1em" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><circle stroke="${t}" fill="#fff" stroke-width="20" cx="50" cy="50" r="40"></circle></svg> ${e}`}function k(e){const t=new ol.layer.Vector({declutter:!0,interactive:!0,style:m(e.color),title:b(e.title,e.color)});t.on("change",A);return l(t,o(e.source)),t}const v=k({source:"nakadake.json",title:"中岳温泉コース",color:"rgba(126,179,44,1)"}),x=k({source:"summit.json",title:"旭岳山頂コース",color:"rgba(255,202,0,1)"}),j=k({source:"loop.json",title:"一日周回コース",color:"rgba(242,133,0,1)"}),S=[k({source:"tennyoga.json",title:"天女ヶ原コース",color:"rgba(33,153,31,1)"}),j,v,x],$=new Map;function A(e){const t=e.target.getSource();if(null===t)return;const r=t.getFeatures();for(let e of r){const t=e.get("src"),r=e.getGeometry(),o=r instanceof ol.geom.Point?r.getCoordinates():void 0;$.set("/"+t,o)}}const P=[];let L=null;function T(){null!==L&&clearTimeout(L),L=setTimeout(()=>{L=null,P.length>0&&P.forEach(e=>e())},200)}return S.forEach(e=>{e.on("change:source",T)}),e.baseTiles=t,e.enLabelsLayer=d,e.highlightTrail=function(e){a.includes(e)||(console.warn(`Can't highlight ${e}. No matching trail found`),i=null),i=e},e.jpLabelsLayer=y,e.onPhotosLoad=function(e){P.push(e)},e.photoLayers=S,e.photoLocations=$,e.trailLayers=g,e}({});
